generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model ApolloPerson {
  apolloPersonId String       @id
  email          String
  firstName      String
  lastName       String?
  title          String?
  linkedinUrl    String?
  organization   String?
  details        Json?
  emailStatus    String // 'verified', 'unverified'
  status         PersonStatus @default(prospect)
  mailCount      Int          @default(0)
  lastMailedAt   DateTime?
  enrichedAt     DateTime     @default(now())

  emails Email[]

  @@index([email])
  @@index([status])
}

enum PersonStatus {
  prospect // Email available, not contacted yet
  emailQueued // Email generation or send job queued
  emailSent // At least one email sent
  followUpSent // Waiting for next follow-up
  awaitingReply // Email sent, waiting for response
  replied // Client replied (positive or neutral)
  qualified // Conversation going well, real interest
  notInterested // Explicit rejection from client
  noReply // Follow-ups exhausted, no response
  dealWon // Client converted
  dealLost // Conversation happened but failed
  unsubscribed // Opted out / requested no contact
}

model Email {
  id String @id @default(cuid())

  personId String
  person   ApolloPerson @relation(fields: [personId], references: [apolloPersonId], onDelete: Cascade)

  direction EmailDirection

  subject     String
  htmlContent String

  status     EmailStatus @default(draft)
  sentAt     DateTime?
  receivedAt DateTime?

  followUpStep Int?

  createdAt DateTime @default(now())

  @@index([personId])
}

enum EmailDirection {
  outbound
  inbound
}

enum EmailStatus {
  draft
  sent
  failed
  received
}
